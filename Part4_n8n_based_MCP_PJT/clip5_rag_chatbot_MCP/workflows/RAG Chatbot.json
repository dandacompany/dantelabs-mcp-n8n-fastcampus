{
  "name": "RAG Chatbot",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "ì•ˆë…•í•˜ì„¸ìš”! ë‹¨í…Œì§€ì‹ë² ì´ìŠ¤ ì±—ë´‡ì…ë‹ˆë‹¤.\nì‹œìŠ¤í…œì— ì €ì¥ëœ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€í•´ë“œë¦´ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në¬´ì—‡ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?",
        "options": {
          "allowFileUploads": true,
          "inputPlaceholder": "ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",
          "showWelcomeScreen": true,
          "subtitle": "ëª¨ë“ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”!",
          "title": "ë‹¨í…Œ ì§€ì‹ë² ì´ìŠ¤ ì±—ë´‡",
          "customCss": ":root {\n  /* Colors */\n  --chat--color-primary: #e74266;\n  --chat--color-primary-shade-50: #db4061;\n  --chat--color-primary-shade-100: #cf3c5c;\n  --chat--color-secondary: #20b69e;\n  --chat--color-secondary-shade-50: #1ca08a;\n  --chat--color-white: #ffffff;\n  --chat--colorf-light: #f2f4f8;\n  --chat--color-light-shade-50: #e6e9f1;\n  --chat--color-light-shade-100: #c2c5cc;\n  --chat--color-medium: #d2d4d9;\n  --chat--color-dark: #101330;\n  --chat--color-disabled: #777980;\n  --chat--color-typing: #404040;\n\n  /* Base Layout */\n  --chat--spacing: 1rem;\n  --chat--border-radius: 0.25rem;\n  --chat--transition-duration: 0.15s;\n  --chat--font-family: (\n    -apple-system,\n    BlinkMacSystemFont,\n    'Segoe UI',\n    Roboto,\n    Oxygen-Sans,\n    Ubuntu,\n    Cantarell,\n    'Helvetica Neue',\n    sans-serif\n  );\n\n  /* Window Dimensions */\n  --chat--window--width: 400px;\n  --chat--window--height: 600px;\n  --chat--window--bottom: var(--chat--spacing);\n  --chat--window--right: var(--chat--spacing);\n  --chat--window--z-index: 9999;\n  --chat--window--border: 1px solid var(--chat--color-light-shade-50);\n  --chat--window--border-radius: var(--chat--border-radius);\n  --chat--window--margin-bottom: var(--chat--spacing);\n\n  /* Header Styles */\n  --chat--header-height: auto;\n  --chat--header--padding: var(--chat--spacing);\n  --chat--header--background: var(--chat--color-dark);\n  --chat--header--color: var(--chat--color-light);\n  --chat--header--border-top: none;\n  --chat--header--border-bottom: none;\n  --chat--header--border-left: none;\n  --chat--header--border-right: none;\n  --chat--heading--font-size: 2em;\n  --chat--subtitle--font-size: inherit;\n  --chat--subtitle--line-height: 1.8;\n\n  /* Message Styles */\n  --chat--message--font-size: 1rem;\n  --chat--message--padding: var(--chat--spacing);\n  --chat--message--border-radius: var(--chat--border-radius);\n  --chat--message-line-height: 1.5;\n  --chat--message--margin-bottom: calc(var(--chat--spacing) * 1);\n  --chat--message--bot--background: var(--chat--color-white);\n  --chat--message--bot--color: var(--chat--color-dark);\n  --chat--message--bot--border: none;\n  --chat--message--user--background: var(--chat--color-secondary);\n  --chat--message--user--color: var(--chat--color-white);\n  --chat--message--user--border: none;\n  --chat--message--pre--background: rgba(0, 0, 0, 0.05);\n  --chat--messages-list--padding: var(--chat--spacing);\n\n  /* Toggle Button */\n  --chat--toggle--size: 64px;\n  --chat--toggle--width: var(--chat--toggle--size);\n  --chat--toggle--height: var(--chat--toggle--size);\n  --chat--toggle--border-radius: 50%;\n  --chat--toggle--background: var(--chat--color-primary);\n  --chat--toggle--hover--background: var(--chat--color-primary-shade-50);\n  --chat--toggle--active--background: var(--chat--color-primary-shade-100);\n  --chat--toggle--color: var(--chat--color-white);\n\n  /* Input Area */\n  --chat--textarea--height: 50px;\n  --chat--textarea--max-height: 30rem;\n  --chat--input--font-size: inherit;\n  --chat--input--border: 0;\n  --chat--input--border-radius: 0;\n  --chat--input--padding: 0.8rem;\n  --chat--input--background: var(--chat--color-white);\n  --chat--input--text-color: initial;\n  --chat--input--line-height: 1.5;\n  --chat--input--placeholder--font-size: var(--chat--input--font-size);\n  --chat--input--border-active: 0;\n  --chat--input--left--panel--width: 2rem;\n\n  /* Button Styles */\n  --chat--button--color: var(--chat--color-light);\n  --chat--button--background: var(--chat--color-primary);\n  --chat--button--padding: calc(var(--chat--spacing) * 1 / 2) var(--chat--spacing);\n  --chat--button--border-radius: var(--chat--border-radius);\n  --chat--button--hover--color: var(--chat--color-light);\n  --chat--button--hover--background: var(--chat--color-primary-shade-50);\n  --chat--close--button--color-hover: var(--chat--color-primary);\n\n  /* Send and File Buttons */\n  --chat--input--send--button--background: var(--chat--color-white);\n  --chat--input--send--button--color: var(--chat--color-light);\n  --chat--input--send--button--background-hover: var(--chat--color-primary-shade-50);\n  --chat--input--send--button--color-hover: var(--chat--color-secondary-shade-50);\n  --chat--input--file--button--background: var(--chat--color-white);\n  --chat--input--file--button--color: var(--chat--color-secondary);\n  --chat--input--file--button--background-hover: var(--chat--input--file--button--background);\n  --chat--input--file--button--color-hover: var(--chat--color-secondary-shade-50);\n  --chat--files-spacing: 0.25rem;\n\n  /* Body and Footer */\n  --chat--body--background: var(--chat--color-light);\n  --chat--footer--background: var(--chat--color-light);\n  --chat--footer--color: var(--chat--color-dark);\n}\n\n\n/* You can override any class styles, too. Right-click inspect in Chat UI to find class to override. */\n.chat-message {\n\tmax-width: 50%;\n}\n\n.chat-get-started-footer {\n  visibility: hidden;\n}",
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -64,
        672
      ],
      "id": "107dad7c-e6c5-4144-aa73-15aa46067856",
      "name": "When chat message received",
      "webhookId": "7add635d-b495-453a-8da5-ad62a7040ff9"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "# ì—­í•  ë° ê°œìš”\në‹¹ì‹ ì€ 'ë‹¨í…Œì§€ì‹ë² ì´ìŠ¤ ì±—ë´‡'ì´ë¼ëŠ” ì´ë¦„ì˜ ì €ì¥ëœ ì§€ì‹ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸ìì—ê²Œ ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ ì „ë¬¸ AI ìƒë‹´ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì„ë¬´ëŠ”, ë‚´ë¶€ ë¬¸ì„œì—ì„œë§Œ ì°¾ì„ ìˆ˜ ìˆëŠ” ìµœì‹ Â·ì •í™•í•œ ì •ë³´ë§Œì„ í™œìš©í•´, ì‚¬ìš©ìì—ê²Œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë‹µì„ ì œê³µí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. \nì‚¬ì ì¸ ê²¬í•´ë‚˜ ì¶”ì¸¡ ì—†ì´, ì˜¤ì§ ê°€ì´ë“œ/ë§¤ë‰´ì–¼/FAQ/ìš´ì˜Â·ì œí’ˆ ë¬¸ì„œ ë“±ì—ì„œ ê·¼ê±°ë¥¼ ì¶”ì¶œí•´ ì„¤ëª…í•©ë‹ˆë‹¤. \n\n# ëª©í‘œ\në‹¹ì‹ ì˜ ê¶ê·¹ì  ëª©í‘œëŠ”, ì œê³µëœ ë³µëµ ê´€ë ¨ ë§¤ë‰´ì–¼ ë° ë¸Œëœë“œ ê³µì‹ ë¬¸ì„œì—ì„œ **ëª…í™•íˆ ê·¼ê±°ê°€ í™•ì¸ë˜ëŠ” ì •ë³´ë§Œì„ ê·¼ê±°ë¡œ** ì‚¬ìš©ì ì§ˆì˜ì— ì •í™•í•˜ê²Œ ë‹µë³€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. \n\n# ì§€ì¹¨\në‹¹ì‹ ì€ RAG(Retrieval-Augmented Generation) ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. \nì‚¬ìš©ì ì§ˆë¬¸ì´ ë“¤ì–´ì˜¤ë©´, Think ë„êµ¬ë¥¼ í†µí•´ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ì „ ê³¼ ë„ì¤‘ì— ê²€ìƒ‰ì–´, ì‚¬ìš©í•œ ê²€ìƒ‰ ë„êµ¬, ê²€ìƒ‰ê²°ê³¼ì˜ ì ì ˆì„±, ê·¸ ë‹¤ìŒ í–‰ë™ì— ëŒ€í•œ ìƒê°ì„ í•©ë‹ˆë‹¤.\nê·¸ì— ë§ì¶°ì„œ ë³µëµ ë‚´ë¶€/ê³µì‹ ë¬¸ì„œì˜ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤(Retrieve Documents, Search Web)ì—ì„œ ì í•©í•œ ë‚´ìš©ì„ ê²€ìƒ‰(ì¡°íšŒ)í•˜ì—¬, ì•„ë˜ ê·œì¹™ì„ ë°˜ë“œì‹œ ë”°ë¦…ë‹ˆë‹¤.\në¬¸ì„œ ê²€ìƒ‰ì„ í•˜ê³  ë‹µë³€ì„ ì°¾ì§€ ëª»í•œ ê²½ìš° ì›¹ ê²€ìƒ‰ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì„œ ì ì ˆí•œ ë‚´ìš©ì´ ë‚˜ì˜¬ë•Œê¹Œì§€ 2-3ì°¨ë¡€ ê²€ìƒ‰ì„ ì§„í–‰ì„ ë” í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n- ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì¹™:\nâ€ƒâ€ƒë‹µë³€ì€ ë¬´ì¡°ê±´ ì œê³µëœ ë‚´ë¶€ ë¬¸ì„œ ì •ë³´ë§Œì—ì„œ ë„ì¶œë˜ì–´ì•¼ í•˜ë©°,\nâ€ƒâ€ƒë¬¸ì„œì— ê·¼ê±° ì—†ëŠ” ì¶”ê°€ ì„¤ëª…Â·í•´ì„Â·ì¶”ì²œÂ·ì¶”ì¸¡ì€ ê¸ˆì§€í•©ë‹ˆë‹¤.\n\n- ì •í™•ì„± ë° ì•”ì‹œì  ì¸ìš©:\nâ€ƒâ€ƒë¬¸ì„œì˜ ë‚´ìš©ì„ ê°€ê° ì—†ì´ ìµœëŒ€í•œ \"ìˆëŠ” ê·¸ëŒ€ë¡œ\" ì“°ë˜,\nâ€ƒâ€ƒì •ë³´ë¥¼ ë” ëª…í™•í•˜ê²Œ ë‹¤ë“¬ì–´ ëª…ë£Œí•˜ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.\nâ€ƒâ€ƒë‹¨, ë¬¸ì„œë¥¼ ë²—ì–´ë‚œ ì‚¬ê²¬/ì§€ì‹/ì˜ˆì‹œëŠ” ì ˆëŒ€ í¬í•¨í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.\nâ€ƒâ€ƒë³¸ì¸ì€ ë‚´ë¶€ ë¬¸ì„œì— ëŒ€í•´ ì•„ëŠ” ì „ë¬¸ê°€ì²˜ëŸ¼ í–‰ë™í•©ë‹ˆë‹¤.\n\n- íˆ´ ë° RAG ì–¸ê¸‰ ê¸ˆì§€:\nâ€ƒâ€ƒíˆ´ì´ë‚˜ ë°ì´í„° ê²€ìƒ‰ ê³¼ì •, RAG ì‹œìŠ¤í…œì„ì„ ì„¤ëª…í•˜ê±°ë‚˜ ì–¸ê¸‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nâ€ƒâ€ƒì˜¤ì§ ê³µì‹ ìƒë‹´ì›ì²˜ëŸ¼ í–‰ë™í•˜ê³ , ë‚´ë¶€ë¬¸ì„œì˜ ì‹ ë¢°ì„±ë§Œ ê°•ì¡°í•˜ì„¸ìš”.\n\n- ëª…í™•ì„±:\nâ€ƒâ€ƒê°„ê²°í•˜ê³ , í•µì‹¬ë§Œì„ ë°”ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.\n\n- êµ¬ì¡°í™”:\nâ€ƒâ€ƒë¬¸ì„œì— ë‹¨ê³„, ì ˆì°¨, ëª©ë¡, ì˜ˆì‹œ, í‘œ, ì•ˆë‚´ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´\nâ€ƒâ€ƒë¶ˆë¦¿/ìˆœì„œ ëª©ë¡ Â· ê°„ê²° ë¬¸ë‹¨ Â· ë§ˆí¬ë‹¤ìš´ í‘œ Â· ì½”ë“œ ë¸”ë¡ ë“±\nâ€ƒâ€ƒMarkdown í˜•ì‹ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ ì •ëˆí•©ë‹ˆë‹¤.\n\n- ì–´ì¡°:\nâ€ƒâ€ƒì‹ ë¢°ê° ìˆê³  ì „ë¬¸ì ì´ë©°, ì¹œì ˆí•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤.\nâ€ƒâ€ƒë¶ˆí™•ì‹¤í•˜ê±°ë‚˜, ë¬¸ì„œì— ì—†ëŠ” ì •ë³´ëŠ” \"ê³µì‹ ë¬¸ì„œì— ê·¼ê±° ì •ë³´ê°€ í™•ì¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\"\nâ€ƒâ€ƒì²˜ëŸ¼ ë‹¨í˜¸í•˜ê²Œ ì•ˆë‚´í•©ë‹ˆë‹¤.\n\n# ì‚¬ìš©ê°€ëŠ¥í•œ ë„êµ¬\n- Retrieve Documents : ì§ˆë¬¸ê³¼ ìœ ê´€í•œ ì €ì¥ëœ ë¬¸ì„œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.\n- Search Web : ì›¹ê²€ìƒ‰ì—”ì§„ì„ ì‚¬ìš©í•´ì„œ ì›¹ë¬¸ì„œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.\n- Think : ê²€ìƒ‰ì–´, ì‚¬ìš©í•œ ê²€ìƒ‰ ë„êµ¬, ê²€ìƒ‰ê²°ê³¼ì˜ ì ì ˆì„±, ê·¸ ë‹¤ìŒ í–‰ë™ì— ëŒ€í•œ ìƒê°ì„ í•©ë‹ˆë‹¤."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        144,
        672
      ],
      "id": "dba55702-1b72-491f-82f1-1f3c99eb8ef0",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -48,
        928
      ],
      "id": "aab7b89c-c6bc-444d-96b4-3fc1affb00e1",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "ZEa0FOrXM9016Vdd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        144,
        928
      ],
      "id": "b211eee6-0c02-493a-ab02-ee01009f2093",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
      "typeVersion": 1,
      "position": [
        752,
        928
      ],
      "id": "c3351f5a-ae13-4764-aa63-f6fa5beaac23",
      "name": "Search Web",
      "credentials": {
        "serpApi": {
          "id": "J4xugzixE4qVJ5lk",
          "name": "SerpAPI account"
        }
      }
    },
    {
      "parameters": {
        "description": "ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì˜ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ, ì ì ˆí•œ ê²€ìƒ‰ì–´ë¥¼ ê³ ë¯¼í•˜ê³ , ê° ë„êµ¬ë¥¼ ì‚¬ìš©í›„ ì‚¬ìš©ìì˜ ìš”ì²­ì— ì í•©í•œì§€ íŒë‹¨í•˜ê³  ê·¸ ë‹¤ìŒ í–‰ë™ì„ ê²°ì •í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.\nìƒê°í•œ ë‚´ìš©ì„ ì»¨í…ìŠ¤íŠ¸ ë©”ëª¨ë¦¬ì— ì¶”ê°€í•´ì¤„ë¿ ë‹¤ë¥¸ ë™ì‘ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        912,
        928
      ],
      "id": "86215426-518f-457b-b5e7-cc99e6ab4263",
      "name": "Think"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": "=document_records",
        "topK": 25,
        "useReranker": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        368,
        928
      ],
      "id": "1825e244-cca3-44ef-85c9-ea4d91af5bfd",
      "name": "Retrieve Records",
      "credentials": {
        "postgres": {
          "id": "lN2fZ27xETHNgKRa",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        336,
        1104
      ],
      "id": "86795c45-91f7-4f23-a195-be0fefa3087e",
      "name": "Embeddings",
      "credentials": {
        "openAiApi": {
          "id": "drLx0rcWm5iXttc5",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "topN": 4
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        512,
        1104
      ],
      "id": "3aee2f85-1d98-4746-b38a-a8ca067b53c8",
      "name": "Reranker",
      "credentials": {
        "cohereApi": {
          "id": "3ow2gYF1XhPMi1Rl",
          "name": "CohereApi account"
        }
      }
    },
    {
      "parameters": {
        "path": "chatbot",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -80,
        1264
      ],
      "id": "8ad7d841-76a7-4008-b705-bad170a20098",
      "name": "Webhook",
      "webhookId": "4224c4d7-bdb4-462f-b60e-517412a3bb6c"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>n8n ì±—ë´‡ ì„ë² ë“œ í…ŒìŠ¤íŠ¸</title>\n    <style>\n        /* í˜ì´ì§€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ê°€ìƒ ëœë”©í˜ì´ì§€) */\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 40px;\n            background-color: #f4f7f6;\n            color: #333;\n            height: 200vh; /* í˜ì´ì§€ê°€ ê¸¸ë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ìŠ¤í¬ë¡¤ ìƒì„± */\n        }\n        h1 {\n            color: #003366;\n        }\n        p {\n            line-height: 1.6;\n        }\n\n        /* --- ì±—ë´‡ ìœ„ì ¯ ìŠ¤íƒ€ì¼ --- */\n\n        /* í”Œë¡œíŒ… ë²„íŠ¼ (ì±—ë´‡ í† ê¸€) */\n        #chat-toggle-button {\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            width: 60px;\n            height: 60px;\n            background-color: #007bff; /* ì›í•˜ëŠ” ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš” */\n            color: white;\n            border: none;\n            border-radius: 50%;\n            font-size: 28px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            cursor: pointer;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n            transition: transform 0.2s ease-in-out;\n            z-index: 9998;\n        }\n\n        #chat-toggle-button:hover {\n            transform: scale(1.1);\n        }\n\n        /* ì±—ë´‡ ì»¨í…Œì´ë„ˆ */\n        #chat-widget-container {\n            position: fixed;\n            bottom: 90px; /* ë²„íŠ¼ ë†’ì´ + ì—¬ë°± */\n            right: 20px;\n            width: 370px;\n            height: 600px;\n            background-color: white;\n            border-radius: 15px;\n            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);\n            overflow: hidden; /* ë‚´ë¶€ iframeì´ ë‘¥ê·¼ ëª¨ì„œë¦¬ë¥¼ ë„˜ì§€ ì•Šë„ë¡ */\n            z-index: 9999;\n            \n            /* ì´ˆê¸° ìƒíƒœ (ìˆ¨ê¹€) */\n            opacity: 0;\n            transform: translateY(20px);\n            pointer-events: none; /* ìˆ¨ê²¨ì ¸ ìˆì„ ë•Œ í´ë¦­ ë°©ì§€ */\n            transition: opacity 0.3s ease-out, transform 0.3s ease-out;\n        }\n\n        /* ì±—ë´‡ ì»¨í…Œì´ë„ˆê°€ ë³´ì¼ ë•Œì˜ ìŠ¤íƒ€ì¼ */\n        #chat-widget-container.visible {\n            opacity: 1;\n            transform: translateY(0);\n            pointer-events: auto; /* ë³´ì¼ ë•Œ ë‹¤ì‹œ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ */\n        }\n\n        /* n8n ì±—ë´‡ iframe */\n        #n8n-chat-iframe {\n            width: 100%;\n            height: 100%;\n            border: none;\n        }\n    </style>\n</head>\n<body>\n\n    <h1>ê°€ìƒì˜ ëœë”© í˜ì´ì§€ì…ë‹ˆë‹¤</h1>\n    <p>ì´ í˜ì´ì§€ëŠ” n8n ì±—ë´‡ì„ ì„ë² ë“œí•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.</p>\n    <p>í˜ì´ì§€ ìš°ì¸¡ í•˜ë‹¨ì˜ íŒŒë€ìƒ‰ ë™ê·¸ë¼ë¯¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì±—ë´‡ê³¼ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>\n    <br>\n    <p>í˜ì´ì§€ë¥¼ ìŠ¤í¬ë¡¤í•´ë„ ë²„íŠ¼ê³¼ ì±„íŒ…ì°½ì€ í•­ìƒ ê°™ì€ ìœ„ì¹˜ì— ê³ ì •ë©ë‹ˆë‹¤.</p>\n\n    <div id=\"chat-widget-container\">\n        <iframe id=\"n8n-chat-iframe\" src=\"\" title=\"n8n Chat\"></iframe>\n    </div>\n\n    <button id=\"chat-toggle-button\" aria-label=\"ì±„íŒ… ì—´ê¸°\">\n        ğŸ’¬\n    </button>\n    \n    <script>\n        // DOM ìš”ì†Œê°€ ëª¨ë‘ ë¡œë“œëœ í›„ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.\n        document.addEventListener('DOMContentLoaded', () => {\n\n            // í•„ìš”í•œ ìš”ì†Œë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.\n            const chatToggleButton = document.getElementById('chat-toggle-button');\n            const chatWidgetContainer = document.getElementById('chat-widget-container');\n            const n8nIframe = document.getElementById('n8n-chat-iframe');\n\n            // n8n Webhook URLì„ ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.\n            const n8nWebhookUrl = 'http://localhost:5678/webhook/4224c4d7-bdb4-462f-b60e-517412a3bb6c';\n\n            // iframeì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í”Œë˜ê·¸\n            let isChatLoaded = false;\n            let isRecursionDetected = false;\n\n            // === ë°©ì–´ ë¡œì§ 1: ì¬ê·€ ë¡œë”© ê°ì§€ ë° ë°©ì§€ ===\n            function detectRecursion() {\n                // í˜„ì¬ í˜ì´ì§€ê°€ iframe ë‚´ë¶€ì—ì„œ ë¡œë“œë˜ê³  ìˆëŠ”ì§€ í™•ì¸\n                if (window !== window.top) {\n                    console.warn('ğŸš¨ ì¬ê·€ ë¡œë”© ê°ì§€: iframe ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ì¤‘');\n                    isRecursionDetected = true;\n                    \n                    // iframe ë‚´ë¶€ì—ì„œëŠ” ì±—ë´‡ ê¸°ëŠ¥ ì™„ì „ ë¹„í™œì„±í™”\n                    chatToggleButton.style.display = 'none';\n                    chatWidgetContainer.style.display = 'none';\n                    \n                    // ëª¨ë“  iframe ìš”ì†Œ ë¹„í™œì„±í™”\n                    const allIframes = document.querySelectorAll('iframe');\n                    allIframes.forEach(iframe => {\n                        iframe.style.display = 'none';\n                        iframe.src = 'about:blank';\n                    });\n                    \n                    // í˜ì´ì§€ ìƒë‹¨ì— ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ\n                    const warningDiv = document.createElement('div');\n                    warningDiv.style.cssText = `\n                        position: fixed;\n                        top: 0;\n                        left: 0;\n                        right: 0;\n                        background: #ff4444;\n                        color: white;\n                        padding: 10px;\n                        text-align: center;\n                        z-index: 10000;\n                        font-weight: bold;\n                    `;\n                    warningDiv.textContent = 'âš ï¸ ì¬ê·€ ë¡œë”© ê°ì§€ë¨ - ì±—ë´‡ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤';\n                    document.body.insertBefore(warningDiv, document.body.firstChild);\n                    \n                    // ì¶”ê°€ ì•ˆì „ì¥ì¹˜: ëª¨ë“  í´ë¦­ ì´ë²¤íŠ¸ ì°¨ë‹¨\n                    document.addEventListener('click', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        console.warn('ì¬ê·€ ê°ì§€ë¡œ ì¸í•´ í´ë¦­ ì°¨ë‹¨');\n                    }, true);\n                    \n                    return true;\n                }\n                return false;\n            }\n\n            // === ë°©ì–´ ë¡œì§ 2: URL ê²€ì¦ ===\n            function validateWebhookUrl() {\n                const currentUrl = window.location.href;\n                \n                // ì¬ê·€ ë¡œë”© ë°©ì§€: webhook URLì´ í˜„ì¬ í˜ì´ì§€ URLì„ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸\n                if (n8nWebhookUrl.includes(currentUrl) || currentUrl.includes(n8nWebhookUrl)) {\n                    console.error('ğŸš¨ URL ê²€ì¦ ì‹¤íŒ¨: ì¬ê·€ ë¡œë”© ìœ„í—˜');\n                    isRecursionDetected = true;\n                    return false;\n                }\n                \n                // webhook URL í˜•ì‹ ê²€ì¦\n                if (!n8nWebhookUrl.startsWith('http') || !n8nWebhookUrl.includes('/webhook/')) {\n                    console.error('ğŸš¨ ì˜ëª»ëœ webhook URL í˜•ì‹');\n                    return false;\n                }\n                \n                return true;\n            }\n\n            // === ë°©ì–´ ë¡œì§ 3: iframe ë¡œë“œ ì˜¤ë¥˜ ì²˜ë¦¬ ===\n            function setupIframeErrorHandling() {\n                n8nIframe.addEventListener('error', (e) => {\n                    console.error('ğŸš¨ iframe ë¡œë“œ ì˜¤ë¥˜:', e);\n                    showErrorMessage('ì±—ë´‡ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');\n                });\n\n                n8nIframe.addEventListener('load', () => {\n                    // iframe ë¡œë“œ í›„ì—ë„ ì¬ê·€ í™•ì¸\n                    setTimeout(() => {\n                        try {\n                            const iframeDoc = n8nIframe.contentDocument || n8nIframe.contentWindow.document;\n                            if (iframeDoc && iframeDoc.location.href === window.location.href) {\n                                console.error('ğŸš¨ iframe ì¬ê·€ ë¡œë”© ê°ì§€');\n                                showErrorMessage('ì±—ë´‡ URLì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');\n                                n8nIframe.src = 'about:blank';\n                            }\n                        } catch (e) {\n                            // Cross-origin ì œí•œìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜ëŠ” ë¬´ì‹œ\n                            console.log('iframe ë‚´ìš© í™•ì¸ ë¶ˆê°€ (ì •ìƒì ì¸ ê²½ìš°)');\n                        }\n                    }, 1000);\n                });\n            }\n\n            // === ë°©ì–´ ë¡œì§ 4: ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ===\n            function showErrorMessage(message) {\n                const errorDiv = document.createElement('div');\n                errorDiv.style.cssText = `\n                    position: fixed;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    background: #ff4444;\n                    color: white;\n                    padding: 20px;\n                    border-radius: 10px;\n                    z-index: 10001;\n                    text-align: center;\n                    max-width: 300px;\n                `;\n                errorDiv.innerHTML = `\n                    <h3>âš ï¸ ì˜¤ë¥˜</h3>\n                    <p>${message}</p>\n                    <button onclick=\"this.parentElement.remove()\" style=\"\n                        background: white;\n                        color: #ff4444;\n                        border: none;\n                        padding: 8px 16px;\n                        border-radius: 5px;\n                        cursor: pointer;\n                        margin-top: 10px;\n                    \">í™•ì¸</button>\n                `;\n                document.body.appendChild(errorDiv);\n            }\n\n            // === ë°©ì–´ ë¡œì§ 5: ì•ˆì „í•œ iframe ë¡œë“œ ===\n            function safeLoadIframe() {\n                if (isRecursionDetected) {\n                    console.warn('ì¬ê·€ ê°ì§€ë¡œ ì¸í•´ iframe ë¡œë“œ ì¤‘ë‹¨');\n                    return false;\n                }\n\n                if (!validateWebhookUrl()) {\n                    showErrorMessage('ì±—ë´‡ URLì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');\n                    return false;\n                }\n\n                try {\n                    n8nIframe.src = n8nWebhookUrl;\n                    isChatLoaded = true;\n                    console.log('âœ… iframe ì•ˆì „í•˜ê²Œ ë¡œë“œë¨');\n                    return true;\n                } catch (e) {\n                    console.error('ğŸš¨ iframe ë¡œë“œ ì‹¤íŒ¨:', e);\n                    showErrorMessage('ì±—ë´‡ì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n                    return false;\n                }\n            }\n\n            // === ì´ˆê¸°í™” ë° ë°©ì–´ ë¡œì§ ì‹¤í–‰ ===\n            if (detectRecursion()) {\n                // ì¬ê·€ ê°ì§€ ì‹œ ì¶”ê°€ ì‘ì—… ì¤‘ë‹¨\n                return;\n            }\n\n            // iframe ì˜¤ë¥˜ ì²˜ë¦¬ ì„¤ì •\n            setupIframeErrorHandling();\n\n            // í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë°©ì–´ ë¡œì§ í¬í•¨)\n            chatToggleButton.addEventListener('click', () => {\n                // ì¬ê·€ ê°ì§€ ì‹œ í´ë¦­ ë¬´ì‹œ\n                if (isRecursionDetected) {\n                    console.warn('ì¬ê·€ ê°ì§€ë¡œ ì¸í•´ í´ë¦­ ë¬´ì‹œ');\n                    return;\n                }\n\n                // ì²˜ìŒ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œë§Œ iframeì˜ srcë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ì„±ëŠ¥ ìµœì í™”)\n                if (!isChatLoaded) {\n                    if (!safeLoadIframe()) {\n                        return; // ë¡œë“œ ì‹¤íŒ¨ ì‹œ í† ê¸€í•˜ì§€ ì•ŠìŒ\n                    }\n                }\n                \n                // 'visible' í´ë˜ìŠ¤ë¥¼ í† ê¸€í•˜ì—¬ ì±„íŒ…ì°½ì„ ë³´ì—¬ì£¼ê±°ë‚˜ ìˆ¨ê¹ë‹ˆë‹¤.\n                chatWidgetContainer.classList.toggle('visible');\n            });\n\n            // === ì¶”ê°€ ì•ˆì „ì¥ì¹˜: í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬ ===\n            window.addEventListener('beforeunload', () => {\n                if (n8nIframe.src && n8nIframe.src !== 'about:blank') {\n                    n8nIframe.src = 'about:blank';\n                }\n            });\n\n        });\n    </script>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        128,
        1264
      ],
      "id": "62f3c508-290e-425f-b093-995aabef2ca2",
      "name": "Respond to Webhook"
    }
  ],
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Search Web": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Retrieve Records": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings": {
      "ai_embedding": [
        [
          {
            "node": "Retrieve Records",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker": {
      "ai_reranker": [
        [
          {
            "node": "Retrieve Records",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e3fdaaf60e2c627d3c0a8ba075e3815e24ea9d8307dd24a904e5c8d8daa0cf76"
  }
}